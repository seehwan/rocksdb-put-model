<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive V4 & V5 RocksDB Put-Rate Model Documentation</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin-top: 30px;
        }
        h3 {
            color: #2980b9;
            margin-top: 25px;
        }
        h4 {
            color: #8e44ad;
            margin-top: 20px;
        }
        .executive-summary {
            background-color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .model-section {
            background-color: #f8f9fa;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        .v4-section {
            border-left-color: #27ae60;
        }
        .v5-section {
            border-left-color: #e74c3c;
        }
        .performance-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background-color: white;
        }
        .performance-table th, .performance-table td {
            border: 1px solid #bdc3c7;
            padding: 12px;
            text-align: center;
        }
        .performance-table th {
            background-color: #34495e;
            color: white;
        }
        .performance-table .rank-1 {
            background-color: #f1c40f;
            font-weight: bold;
        }
        .performance-table .rank-2 {
            background-color: #f39c12;
            font-weight: bold;
        }
        .performance-table .rank-3 {
            background-color: #e67e22;
        }
        .code-block {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
        }
        .insight-box {
            background-color: #e8f5e8;
            border: 1px solid #27ae60;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .warning-box {
            background-color: #fdf2e9;
            border: 1px solid #e67e22;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .failure-box {
            background-color: #fadbd8;
            border: 1px solid #e74c3c;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .metrics {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        .metric {
            text-align: center;
            padding: 15px;
            background-color: #ecf0f1;
            border-radius: 8px;
            min-width: 120px;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #2980b9;
        }
        .metric-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        ul, ol {
            padding-left: 20px;
        }
        li {
            margin: 5px 0;
        }
        .highlight {
            background-color: #fff3cd;
            padding: 2px 5px;
            border-radius: 3px;
        }
        .toc {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .toc ul {
            list-style-type: none;
            padding-left: 0;
        }
        .toc li {
            margin: 8px 0;
        }
        .toc a {
            text-decoration: none;
            color: #2980b9;
        }
        .toc a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Comprehensive V4 & V5 RocksDB Put-Rate Model Documentation</h1>
        <p><strong>Complete Analysis of RocksDB Performance Prediction Models</strong><br>
        <em>Based on 2025-09-12 Experimental Results</em></p>

        <div class="toc">
            <h3>Table of Contents</h3>
            <ul>
                <li><a href="#executive-summary">1. Executive Summary</a></li>
                <li><a href="#experimental-context">2. Experimental Context</a></li>
                <li><a href="#v4-model-family">3. V4 Model Family</a></li>
                <li><a href="#v5-model-family">4. V5 Model Family</a></li>
                <li><a href="#comparative-analysis">5. Comparative Analysis</a></li>
                <li><a href="#key-insights">6. Key Insights and Lessons</a></li>
                <li><a href="#technical-specifications">7. Technical Specifications</a></li>
                <li><a href="#recommendations">8. Recommendations</a></li>
            </ul>
        </div>

        <div id="executive-summary" class="executive-summary">
            <h2>Executive Summary</h2>
            
            <h3>Research Question</h3>
            <p>How can we accurately predict RocksDB's sustainable put rate (S_max) across different operational phases?</p>

            <h3>Key Findings</h3>
            <ul>
                <li><strong>V4 Family</strong> achieved superior performance through <strong>simplicity and focus</strong></li>
                <li><strong>V5 Family</strong> failed despite sophisticated approaches due to <strong>parameter redundancy</strong></li>
                <li><strong>"Less is More"</strong> principle confirmed: Simple models outperform complex ones</li>
                <li><strong>Parameter independence</strong> is critical for model stability and performance</li>
            </ul>

            <div class="metrics">
                <div class="metric">
                    <div class="metric-value">81.4%</div>
                    <div class="metric-label">V4 Best Performance</div>
                </div>
                <div class="metric">
                    <div class="metric-value">60.8%</div>
                    <div class="metric-label">V5 Best Performance</div>
                </div>
                <div class="metric">
                    <div class="metric-value">22.6%</div>
                    <div class="metric-label">Performance Gap</div>
                </div>
                <div class="metric">
                    <div class="metric-value">-0.640</div>
                    <div class="metric-label">Complexity-Performance Correlation</div>
                </div>
            </div>
        </div>

        <h2 id="experimental-context">Experimental Context</h2>

        <h3>2025-09-12 Experiment Setup</h3>
        <ul>
            <li><strong>Workload</strong>: FillRandom (Sequential writes, no user reads)</li>
            <li><strong>Duration</strong>: 120 minutes</li>
            <li><strong>Database</strong>: Empty → ~50GB</li>
            <li><strong>Device</strong>: SSD with observed degradation</li>
            <li><strong>Key Observation</strong>: Performance decline from 138k to 109k ops/sec</li>
        </ul>

        <h3>Phase Segmentation</h3>
        
        <table class="performance-table">
            <thead>
                <tr>
                    <th>Phase</th>
                    <th>Duration</th>
                    <th>Actual QPS</th>
                    <th>Key Characteristics</th>
                    <th>Modeling Difficulty</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Initial</strong></td>
                    <td>0-30 min</td>
                    <td>138,769</td>
                    <td>Empty DB, High volatility (CV=0.538)</td>
                    <td>Medium</td>
                </tr>
                <tr>
                    <td><strong>Middle</strong></td>
                    <td>30-90 min</td>
                    <td>114,472</td>
                    <td>Device degradation (73.9%), WA increases</td>
                    <td>High</td>
                </tr>
                <tr>
                    <td><strong>Final</strong></td>
                    <td>90-120 min</td>
                    <td>109,678</td>
                    <td>High stability (CV=0.041), High amplification</td>
                    <td>Very High</td>
                </tr>
            </tbody>
        </table>

        <h2 id="v4-model-family">V4 Model Family</h2>

        <div class="model-section v4-section">
            <h3>V4 Device Envelope Model (Champion)</h3>
            
            <h4>Philosophy</h4>
            <div class="insight-box">
                <strong>"Identify the Right Constraint, Not All Constraints"</strong><br>
                The V4 model operates on the principle that system performance is ultimately limited by a single dominant constraint: device I/O capacity.
            </div>

            <h4>Technical Implementation</h4>
            <div class="code-block">
Core Formula: S_max = (device_write_bw × 1024 × 1024) / 1040 × device_utilization

Where:
- device_write_bw: Measured device write bandwidth (MB/s)
- device_utilization: Observed utilization ratio (phase-specific)
- 1040: Average record size in bytes
            </div>

            <h4>Performance Results</h4>
            <table class="performance-table">
                <thead>
                    <tr>
                        <th>Phase</th>
                        <th>Accuracy</th>
                        <th>Ranking</th>
                        <th>Assessment</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Initial</td>
                        <td>66.7%</td>
                        <td>4th</td>
                        <td>Good</td>
                    </tr>
                    <tr class="rank-2">
                        <td>Middle</td>
                        <td>90.8%</td>
                        <td>2nd</td>
                        <td>Excellent</td>
                    </tr>
                    <tr class="rank-1">
                        <td>Final</td>
                        <td>86.6%</td>
                        <td>1st</td>
                        <td>Champion</td>
                    </tr>
                    <tr class="rank-1">
                        <td><strong>Overall</strong></td>
                        <td><strong>81.4%</strong></td>
                        <td><strong>1st</strong></td>
                        <td><strong>Champion</strong></td>
                    </tr>
                </tbody>
            </table>

            <h4>Success Factors</h4>
            <ul>
                <li><strong>Single Constraint Focus</strong>: Device performance as the ultimate bottleneck</li>
                <li><strong>Implicit Adaptation</strong>: Device utilization changes capture phase characteristics</li>
                <li><strong>Information Efficiency</strong>: Maximum accuracy with minimum parameters</li>
                <li><strong>Robust Simplicity</strong>: Consistent performance across all phases</li>
            </ul>
        </div>

        <div class="model-section v4-section">
            <h3>V4.1 Temporal Enhanced Model</h3>
            
            <h4>Philosophy</h4>
            <div class="insight-box">
                <strong>"Time-Aware Performance Evolution"</strong><br>
                V4.1 extends V4 by explicitly modeling how RocksDB performance characteristics evolve over time.
            </div>

            <h4>Performance Results</h4>
            <table class="performance-table">
                <thead>
                    <tr>
                        <th>Phase</th>
                        <th>Accuracy</th>
                        <th>Ranking</th>
                        <th>Assessment</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Initial</td>
                        <td>68.5%</td>
                        <td>1st*</td>
                        <td>Excellent</td>
                    </tr>
                    <tr class="rank-1">
                        <td>Middle</td>
                        <td>96.9%</td>
                        <td>1st</td>
                        <td>Outstanding</td>
                    </tr>
                    <tr>
                        <td>Final</td>
                        <td>70.5%</td>
                        <td>3rd</td>
                        <td>Good</td>
                    </tr>
                    <tr class="rank-2">
                        <td><strong>Overall</strong></td>
                        <td><strong>78.6%</strong></td>
                        <td><strong>2nd</strong></td>
                        <td><strong>Excellent</strong></td>
                    </tr>
                </tbody>
            </table>

            <div class="insight-box">
                <strong>Key Achievement</strong>: 96.9% accuracy in Middle Phase - highest single-phase performance across all models
            </div>
        </div>

        <h2 id="v5-model-family">V5 Model Family</h2>

        <div class="model-section v5-section">
            <h3>V5 Development Philosophy</h3>
            <div class="warning-box">
                <strong>"Adaptive Intelligence Through Comprehensive Integration"</strong><br>
                The V5 family represents attempts to create "intelligent" adaptive models that consider multiple factors simultaneously, automatically adjusting to different operational phases and conditions.
            </div>
        </div>

        <div class="model-section v5-section">
            <h3>V5 Original Adaptive Model</h3>
            
            <h4>Approach</h4>
            <p><strong>Ensemble Adaptive Modeling</strong> - Combine multiple modeling approaches through ensemble methods</p>

            <h4>Performance Results</h4>
            <table class="performance-table">
                <thead>
                    <tr>
                        <th>Phase</th>
                        <th>Accuracy</th>
                        <th>Assessment</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="rank-1">
                        <td>Initial</td>
                        <td>86.4%</td>
                        <td>Excellent</td>
                    </tr>
                    <tr>
                        <td>Middle</td>
                        <td>85.9%</td>
                        <td>Good</td>
                    </tr>
                    <tr class="failure">
                        <td>Final</td>
                        <td>10.1%</td>
                        <td>Failed</td>
                    </tr>
                    <tr class="rank-3">
                        <td><strong>Overall</strong></td>
                        <td><strong>60.8%</strong></td>
                        <td><strong>Best V5</strong></td>
                    </tr>
                </tbody>
            </table>

            <div class="failure-box">
                <strong>Critical Failure</strong>: Complete collapse in final phase (10.1%) due to ensemble instability
            </div>
        </div>

        <div class="model-section v5-section">
            <h3>V5 Evolution Summary</h3>
            
            <table class="performance-table">
                <thead>
                    <tr>
                        <th>V5 Model</th>
                        <th>Approach</th>
                        <th>Overall Accuracy</th>
                        <th>Key Innovation</th>
                        <th>Main Issue</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="rank-3">
                        <td><strong>V5 Original</strong></td>
                        <td>Ensemble</td>
                        <td><strong>60.8%</strong></td>
                        <td>Multi-model combination</td>
                        <td>Final phase collapse</td>
                    </tr>
                    <tr>
                        <td>V5 Improved v2</td>
                        <td>Multi-Model</td>
                        <td>43.1%</td>
                        <td>Phase isolation</td>
                        <td>Core constraint failure</td>
                    </tr>
                    <tr>
                        <td>V5 Fine-Tuned</td>
                        <td>Parameter Tuning</td>
                        <td>39.4%</td>
                        <td>Precision optimization</td>
                        <td>Still complex vs V4</td>
                    </tr>
                    <tr>
                        <td>V5 Independence</td>
                        <td>Redundancy Elimination</td>
                        <td>38.0%</td>
                        <td>Parameter independence</td>
                        <td>Accuracy limitation</td>
                    </tr>
                    <tr>
                        <td>V5 Final</td>
                        <td>Complete Integration</td>
                        <td>27.8%</td>
                        <td>All factors included</td>
                        <td>Over-complexity</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h2 id="comparative-analysis">Comparative Analysis</h2>

        <h3>Performance Comparison Matrix</h3>
        <table class="performance-table">
            <thead>
                <tr>
                    <th>Model</th>
                    <th>Initial</th>
                    <th>Middle</th>
                    <th>Final</th>
                    <th>Average</th>
                    <th>Consistency</th>
                    <th>Complexity</th>
                </tr>
            </thead>
            <tbody>
                <tr class="rank-1">
                    <td><strong>V4</strong></td>
                    <td>66.7%</td>
                    <td>90.8%</td>
                    <td>86.6%</td>
                    <td><strong>81.4%</strong></td>
                    <td>High</td>
                    <td>Low</td>
                </tr>
                <tr class="rank-2">
                    <td><strong>V4.1</strong></td>
                    <td>68.5%</td>
                    <td><strong>96.9%</strong></td>
                    <td>70.5%</td>
                    <td><strong>78.6%</strong></td>
                    <td>Medium</td>
                    <td>Medium</td>
                </tr>
                <tr>
                    <td>V4.2</td>
                    <td>23.9%</td>
                    <td>96.0%</td>
                    <td>-28.5%</td>
                    <td>30.5%</td>
                    <td>Low</td>
                    <td>High</td>
                </tr>
                <tr class="rank-3">
                    <td><strong>V5 Original</strong></td>
                    <td><strong>86.4%</strong></td>
                    <td>85.9%</td>
                    <td>10.1%</td>
                    <td><strong>60.8%</strong></td>
                    <td>Low</td>
                    <td>High</td>
                </tr>
                <tr>
                    <td>V5 Fine-Tuned</td>
                    <td>56.8%</td>
                    <td>21.1%</td>
                    <td>40.1%</td>
                    <td>39.4%</td>
                    <td>High</td>
                    <td>Medium</td>
                </tr>
                <tr>
                    <td>V5 Independence</td>
                    <td>56.8%</td>
                    <td>27.8%</td>
                    <td>29.4%</td>
                    <td>38.0%</td>
                    <td>High</td>
                    <td>Medium</td>
                </tr>
            </tbody>
        </table>

        <h2 id="key-insights">Key Insights and Lessons</h2>

        <h3>1. The Simplicity Principle</h3>
        <div class="insight-box">
            <h4>"Right Constraint, Not All Constraints"</h4>
            
            <h5>V4 Success Formula</h5>
            <ul>
                <li><strong>Focus</strong>: Single dominant constraint (device performance)</li>
                <li><strong>Approach</strong>: Simple but accurate constraint identification</li>
                <li><strong>Result</strong>: Highest overall performance (81.4%)</li>
            </ul>

            <h5>V5 Failure Pattern</h5>
            <ul>
                <li><strong>Focus</strong>: Multiple constraints simultaneously</li>
                <li><strong>Approach</strong>: Comprehensive factor integration</li>
                <li><strong>Result</strong>: Lower performance despite theoretical completeness</li>
            </ul>
        </div>

        <h3>2. Parameter Independence Critical Discovery</h3>
        <div class="failure-box">
            <h4>"V5 Parameters Are Not Independent of V4 Parameters"</h4>
            
            <h5>Identified Redundancies</h5>
            <div class="code-block">
EXACT DUPLICATES:
- system_volatility = cv (identical)
- system_stability = 1 - cv (inverse)
- combined_amplification = wa + ra (simple sum)

DERIVED PARAMETERS:
- device_degradation = (initial_bw - current_bw) / initial_bw
            </div>

            <h5>Impact Analysis</h5>
            <ul>
                <li><strong>Redundancy-Performance Correlation</strong>: -0.755 (Strong negative)</li>
                <li><strong>Finding</strong>: Higher parameter redundancy correlates with lower performance</li>
                <li><strong>Implication</strong>: V5 models use same information multiple times in different forms</li>
            </ul>
        </div>

        <h3>3. Information Efficiency Principle</h3>
        <div class="insight-box">
            <h4>"V4's Simplicity = Information Efficiency"</h4>
            
            <table class="performance-table">
                <thead>
                    <tr>
                        <th>Model</th>
                        <th>Parameters</th>
                        <th>Accuracy</th>
                        <th>Efficiency (Acc/Param)</th>
                        <th>Redundancy</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="rank-1">
                        <td><strong>V4</strong></td>
                        <td>1</td>
                        <td>81.4%</td>
                        <td><strong>81.4%</strong></td>
                        <td>0</td>
                    </tr>
                    <tr class="rank-2">
                        <td><strong>V4.1</strong></td>
                        <td>2-3</td>
                        <td>78.6%</td>
                        <td><strong>26-39%</strong></td>
                        <td>0</td>
                    </tr>
                    <tr>
                        <td>V5 Original</td>
                        <td>5</td>
                        <td>60.8%</td>
                        <td>12.2%</td>
                        <td>1</td>
                    </tr>
                    <tr>
                        <td>V5 Final</td>
                        <td>7</td>
                        <td>27.8%</td>
                        <td>4.0%</td>
                        <td>3</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <h2 id="technical-specifications">Technical Specifications</h2>

        <h3>V4 Model Implementation</h3>
        <div class="code-block">
def predict_v4_s_max(device_write_bw, phase):
    base_s_max = (device_write_bw * 1024 * 1024) / 1040
    
    if phase == 'initial':
        device_utilization = 0.019  # 1.9%
    elif phase == 'middle':
        device_utilization = 0.047  # 4.7%
    else:  # final
        device_utilization = 0.046  # 4.6%
    
    return base_s_max * device_utilization
        </div>

        <h3>V5 Parameter Independence Analysis</h3>
        <div class="code-block">
ELIMINATED REDUNDANT PARAMETERS:
✗ system_volatility (= cv)
✗ system_stability (= 1-cv)  
✗ combined_amplification (= wa+ra)
✗ device_degradation (= device_write_bw temporal change)

INDEPENDENT PARAMETERS RETAINED:
✓ device_write_bw (hardware measurement)
✓ cv (system variability)
✓ wa (RocksDB compaction logs)
✓ ra (RocksDB compaction logs)
        </div>

        <h2 id="recommendations">Recommendations</h2>

        <h3>For Practical Applications</h3>
        
        <div class="insight-box">
            <h4>Primary Recommendation</h4>
            <p><strong>Use V4 Device Envelope Model as the standard approach</strong></p>
            <ul>
                <li><strong>Rationale</strong>: Highest overall performance (81.4%)</li>
                <li><strong>Benefits</strong>: Simple implementation, consistent results, robust across phases</li>
                <li><strong>Use Cases</strong>: General RocksDB performance prediction</li>
            </ul>
        </div>

        <div class="warning-box">
            <h4>Secondary Recommendation</h4>
            <p><strong>Consider V4.1 Temporal for middle-phase optimization</strong></p>
            <ul>
                <li><strong>Rationale</strong>: Outstanding middle phase performance (96.9%)</li>
                <li><strong>Benefits</strong>: Temporal awareness, excellent transition period modeling</li>
                <li><strong>Use Cases</strong>: Scenarios requiring middle-phase accuracy</li>
            </ul>
        </div>

        <div class="failure-box">
            <h4>Not Recommended</h4>
            <p><strong>Avoid V5 family approaches for production use</strong></p>
            <ul>
                <li><strong>Rationale</strong>: All V5 models perform worse than V4 despite higher complexity</li>
                <li><strong>Issues</strong>: Parameter redundancy, over-complexity, instability</li>
                <li><strong>Exception</strong>: V5 approaches valuable for research and understanding failure modes</li>
            </ul>
        </div>

        <h3>Model Selection Decision Framework</h3>
        <div class="code-block">
if (primary_goal == "overall_accuracy"):
    use V4_device_envelope_model
elif (primary_goal == "middle_phase_optimization"):
    use V4_1_temporal_model
elif (research_purpose == "understanding_failure_modes"):
    study V5_family_approaches
else:
    default_to V4_device_envelope_model
        </div>

        <h3>Lessons for Future Model Development</h3>
        <ol>
            <li><strong>Principle of Parsimony</strong>: Start simple, add complexity only when necessary</li>
            <li><strong>Parameter Independence</strong>: Verify statistical independence before adding parameters</li>
            <li><strong>Information Efficiency</strong>: Maximize accuracy per parameter used</li>
            <li><strong>Constraint Focus</strong>: Identify the right constraint, not all constraints</li>
        </ol>

        <h2>Conclusion</h2>

        <div class="insight-box">
            <h3>The Great V4 vs V5 Experiment Results</h3>
            <p>This comprehensive analysis reveals a fundamental truth about performance modeling:</p>
            <p><strong>Simplicity, when applied to the right constraint, consistently outperforms complexity.</strong></p>

            <h4>Key Discoveries</h4>
            <ol>
                <li><strong>V4's Genius</strong>: Identifying device I/O as the single dominant constraint</li>
                <li><strong>V5's Trap</strong>: Attempting to model everything leads to modeling nothing well</li>
                <li><strong>Parameter Independence</strong>: Critical for model stability but not sufficient for accuracy</li>
                <li><strong>Temporal Modeling</strong>: V4.1 shows appropriate complexity can work, but V5 over-engineers it</li>
                <li><strong>Information Efficiency</strong>: V4 achieves maximum performance with minimum parameters</li>
            </ol>

            <h4>Final Verdict</h4>
            <p>The <strong>V4 Device Envelope Model</strong> stands as the clear winner, demonstrating that in performance modeling, the best solution is often the simplest one that correctly identifies and models the fundamental constraint.</p>
            
            <p>The V5 family serves as valuable lessons in the pitfalls of over-engineering and the importance of parameter independence in statistical modeling.</p>
            
            <p><strong>In the end, V4's 81.4% accuracy with a single constraint beats V5's best 60.8% accuracy with multiple constraints - a testament to the power of focused simplicity.</strong></p>
        </div>

        <hr>
        <p><em>Document Version: 1.0<br>
        Last Updated: 2025-09-20<br>
        Analysis Based on: 2025-09-12 Experimental Results</em></p>
    </div>
</body>
</html>
