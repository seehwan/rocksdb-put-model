# RocksDB Put Model v2.1 μΆ…ν•© λ¶„μ„ λ³΄κ³ μ„

**μ‹¤ν–‰ μΌμ‹**: 2025-09-05  
**λ¶„μ„ λ²”μ„**: v2.1 λ¨λΈ μ΄λ΅  λ¶„μ„, νλΌλ―Έν„° μ¶”μ¶, κ²€μ¦ μ‹¤ν–‰, v1 λ€λΉ„ λΉ„κµ  
**μƒνƒ**: β… μ™„λ£  

---

## π“‹ λ©μ°¨

1. [v2.1 λ¨λΈ μ΄λ΅  λ¶„μ„](#1-v21-λ¨λΈ-μ΄λ΅ -λ¶„μ„)
2. [μ‹¤ν— λ°μ΄ν„° κΈ°λ° νλΌλ―Έν„° μ¶”μ¶](#2-μ‹¤ν—-λ°μ΄ν„°-κΈ°λ°-νλΌλ―Έν„°-μ¶”μ¶)
3. [v2.1 λ¨λΈ κ²€μ¦ μ‹¤ν–‰](#3-v21-λ¨λΈ-κ²€μ¦-μ‹¤ν–‰)
4. [v1 vs v2.1 λ¨λΈ λΉ„κµ](#4-v1-vs-v21-λ¨λΈ-λΉ„κµ)
5. [μƒμ„Έ λ¶„μ„ λ° κ°μ„  λ°©ν–¥](#5-μƒμ„Έ-λ¶„μ„-λ°-κ°μ„ -λ°©ν–¥)
6. [κ²°λ΅  λ° κ¶μ¥μ‚¬ν•­](#6-κ²°λ΅ -λ°-κ¶μ¥μ‚¬ν•­)

---

## 1. v2.1 λ¨λΈ μ΄λ΅  λ¶„μ„

### 1.1 v2.1 λ¨λΈμ ν•µμ‹¬ κ°μ„ μ‚¬ν•­

#### A. Mixed I/O Capacity λ¨λΈλ§ κ°μ„ 
- **v1**: λ‹¨μ μ‚°μ  ν‰κ·  `B_eff = (B_r + B_w) / 2`
- **v2.1**: Harmonic mean `B_eff(Ο_r, Ο_w) = 1 / (Ο_r / B_r + Ο_w / B_w)`
- **μ¥μ **: μ½κΈ°/μ“°κΈ° λΉ„μ¨μ— λ”°λ¥Έ λ” ν„μ‹¤μ μΈ λ€μ—­ν­ κ³„μ‚°

#### B. Per-Level Capacity & Concurrency κ³ λ ¤
- **λ λ²¨λ³„ μ“°κΈ° κ³µμ μ¨**: `share_l = W_l / Ξ£W_l`
- **λ λ²¨λ³„ μ½κΈ°/μ“°κΈ° λΉ„μ¨**: `(read_to_write)_l`
- **λ λ²¨λ³„ λ™μ‹μ„± μ μ•½**: `k_l`, `s_l`, `ΞΌ_eff_l`
- **μ¥μ **: LSM-treeμ λ λ²¨λ³„ νΉμ„±μ„ μ •ν™•ν λ°μ

#### C. Stall Duty Cycle λ¨λΈλ§
- **Stall ν™•λ¥ **: `p_stall` (L0 νμΌ μ, pending compactions λ“±)
- **μµμΆ… μ„±λ¥**: `S_max_final = S_max_feasible Γ— (1 - p_stall)`
- **μ¥μ **: μ‹¤μ  μ΄μ ν™κ²½μ μ„±λ¥ λ³€λ™μ„± λ°μ

### 1.2 v2.1 λ¨λΈ μμ‹

#### κΈ°λ³Έ λ°”μ΄λ“ (v1κ³Ό λ™μΌ)
```
S_write = B_w / w_req
S_read = B_r / r_req
```

#### v2.1 νΌν•© I/O λ°”μ΄λ“
```
B_eff(Ο_r, Ο_w) = 1 / (Ο_r / B_r + Ο_w / B_w)
S_mix = B_eff / (w_req + r_req)
```

#### μµμΆ… S_max
```
S_max = min(S_write, S_read, S_mix, S_level_constraints) Γ— (1 - p_stall)
```

---

## 2. μ‹¤ν— λ°μ΄ν„° κΈ°λ° νλΌλ―Έν„° μ¶”μ¶

### 2.1 Phase-A: λ””λ°”μ΄μ¤ μΊλ¦¬λΈλ μ΄μ… κ²°κ³Ό
```json
{
  "B_w": 1484,    // μ“°κΈ° λ€μ—­ν­ (MiB/s)
  "B_r": 2368,    // μ½κΈ° λ€μ—­ν­ (MiB/s)  
  "B_eff": 2231   // νΌν•© I/O λ€μ—­ν­ (MiB/s)
}
```

### 2.2 Phase-B: RocksDB λ²¤μΉλ§ν¬ κ²°κ³Ό
```json
{
  "actual_performance": 187.1,    // μ‹¤μ  μ„±λ¥ (MiB/s)
  "compression_ratio": 0.54,      // μ••μ¶•λ¥ 
  "wa_statistics": 1.02,          // STATISTICS κΈ°λ° WA
  "stall_percentage": 45.31       // Stall λΉ„μ¨ (%)
}
```

### 2.3 Phase-C: Per-Level WAF λ¶„μ„ κ²°κ³Ό
```json
{
  "level_data": {
    "L0": {"write_gb": 1670.1, "w_amp": 0.0},
    "L1": {"write_gb": 1036.0, "w_amp": 0.0}, 
    "L2": {"write_gb": 3968.1, "w_amp": 22.6},
    "L3": {"write_gb": 2096.4, "w_amp": 0.9}
  },
  "total_write_gb": 8770.6,
  "total_wa_log": 2.87
}
```

### 2.4 v2.1 λ¨λΈ νλΌλ―Έν„° μ¶”μ¶

#### κΈ°λ³Έ I/O λ€μ—­ν­
- `B_w = 1484` MiB/s (Phase-A)
- `B_r = 2368` MiB/s (Phase-A)
- `B_eff = 2231` MiB/s (Phase-A)

#### μ½κΈ°/μ“°κΈ° νΌν•© λΉ„μ¨ (μμ •λ¨)
- `Ο_r = 0.000522` (μ½κΈ° λΉ„μ¨, 0.0522%)
- `Ο_w = 0.999478` (μ“°κΈ° λΉ„μ¨, 99.9478%)

#### λ λ²¨λ³„ μ“°κΈ° κ³µμ μ¨ (share_l)
- `L0`: 0.190 (19.0%)
- `L1`: 0.118 (11.8%)
- `L2`: 0.452 (45.2%) β† **μ£Όμ” λ³‘λ©**
- `L3`: 0.239 (23.9%)

#### λ λ²¨λ³„ μ½κΈ°/μ“°κΈ° λΉ„μ¨ (read_to_write)_l) (μμ •λ¨)
- `L0`: 0.0009 (0.09%)
- `L1`: 0.0018 (0.18%)
- `L2`: 0.0002 (0.02%)
- `L3`: 0.0002 (0.02%)

#### κΈ°νƒ€ νλΌλ―Έν„°
- `p_stall = 0.453` (45.3% stall)
- `CR = 0.54` (μ••μ¶•λ¥ )
- `WA = 2.87` (LOG κΈ°λ° Write Amplification)

---

## 3. v2.1 λ¨λΈ κ²€μ¦ μ‹¤ν–‰

### 3.1 v2.1 κ³„μ‚°κΈ° κµ¬ν„

**νμΌ**: `scripts/smax_calc_v2.py`

#### μ£Όμ” κΈ°λ¥
- Harmonic mean νΌν•© I/O λ€μ—­ν­ κ³„μ‚°
- Per-level μ μ•½μ‚¬ν•­ κ³ λ ¤
- Stall ν¨κ³Ό λ°μ
- μƒμ„Έν• λ λ²¨λ³„ λ¶„μ„ μ κ³µ

### 3.2 κ²€μ¦ μ‹¤ν–‰ κ²°κ³Ό

#### μμ •λ νλΌλ―Έν„° (p_stall=0.453, Ο_r=0.000522, Ο_w=0.999478)
```
μ…λ ¥ νλΌλ―Έν„°:
  μ••μ¶•λ¥  (CR): 0.54
  Write Amplification (WA): 2.9
  μ“°κΈ° λ€μ—­ν­ (B_w): 1484 MiB/s
  μ½κΈ° λ€μ—­ν­ (B_r): 2368 MiB/s
  μ½κΈ° λΉ„μ¨ (Ο_r): 0.000522 (0.0522%)
  μ“°κΈ° λΉ„μ¨ (Ο_w): 0.999478 (99.9478%)
  Stall ν™•λ¥  (p_stall): 0.453

κ³„μ‚° κ²°κ³Ό:
  per-user μ“°κΈ° μ”κµ¬λ‰: 1.55
  per-user μ½κΈ° μ”κµ¬λ‰: 1.01
  Harmonic mean λ€μ—­ν­: 1484.3 MiB/s

λ°”μ΄λ“λ³„ S_max:
  Write bound:        957.5 MiB/s
  Read bound:         2345.0 MiB/s
  Mixed (Harmonic):   579.9 MiB/s
  Level constraint:   40.6 MiB/s

μµμΆ… S_max:
  Feasible (stall μ „): 40.6 MiB/s
  Final (stall ν›„):    22.2 MiB/s
  λ³‘λ© μ§€μ : level_constraint
  ops/s (1KB KV): 22731

λ λ²¨λ³„ μ μ•½μ‚¬ν•­:
  L0: 957.7 MiB/s (κ³µμ μ¨: 0.190, μ½κΈ°/μ“°κΈ°: 0.0009)
  L1: 957.7 MiB/s (κ³µμ μ¨: 0.118, μ½κΈ°/μ“°κΈ°: 0.0018)
  L2: 40.6 MiB/s (κ³µμ μ¨: 0.452, μ½κΈ°/μ“°κΈ°: 0.0002)
  L3: 504.1 MiB/s (κ³µμ μ¨: 0.239, μ½κΈ°/μ“°κΈ°: 0.0002)
```

---

## 4. v1 vs v2.1 λ¨λΈ λΉ„κµ

### 4.1 μ •λ‰μ  λΉ„κµ

| ν•­λ© | v1 λ¨λΈ | v2.1 (μμ •) | μ‹¤μ  μΈ΅μ •κ°’ | κ°μ„ μ¨ |
|------|---------|-------------|-------------|--------|
| **S_max** | 582.0 MiB/s | 22.2 MiB/s | 187.1 MiB/s | **58.2%** |
| **μ¤λ¥μ¨** | +211.1% | -88.1% | - | **122.9%p** |
| **λ³‘λ© μ§€μ ** | write | level_constraint | L2 | **μ •ν™•** |
| **μ •ν™•λ„** | λ‚®μ | μ¤‘κ°„ | κΈ°μ¤€ | **ν–¥μƒ** |

### 4.2 μ •ν™•λ„ κ°μ„  λ¶„μ„

#### v1 λ¨λΈμ λ¬Έμ μ 
- **κ³Όλ€ μμΈ΅**: μ‹¤μ λ³΄λ‹¤ 3.1λ°° λ†’μ€ μ„±λ¥ μμΈ΅
- **λ‹¨μν• λ¨λΈλ§**: Mixed I/O μƒν™©μ„ μ λ€λ΅ λ°μν•μ§€ λ»ν•¨
- **λ λ²¨ λ¬΄μ‹**: LSM-treeμ λ λ²¨λ³„ νΉμ„± λ―Έκ³ λ ¤

#### v2.1 λ¨λΈμ κ°μ„ μ 
- **Harmonic mean**: λ” ν„μ‹¤μ μΈ νΌν•© I/O λ¨λΈλ§
- **Per-level λ¶„μ„**: λ λ²¨λ³„ μ μ•½μ‚¬ν•­ κ³ λ ¤
- **Stall λ¨λΈλ§**: μ‹¤μ  μ‹μ¤ν…μ μ„±λ¥ λ³€λ™μ„± λ°μ
- **L2 λ³‘λ© μ‹λ³„**: μ‹¤μ  λ³‘λ© μ§€μ μ„ μ¬λ°”λ¥΄κ² μ‹λ³„

#### μ •ν™•λ„ κ°μ„  κ²°κ³Ό (μμ •λ¨)
- **v2.1μ΄ v1λ³΄λ‹¤ 58.2% λ” μ •ν™•**
- **v1**: 211.1% μ¤λ¥μ¨ β†’ **v2.1 (μμ •)**: 88.1% μ¤λ¥μ¨
- **κ°μ„ ν­**: 122.9%p ν–¥μƒ
- **μ‹¤μ  μ½κΈ°/μ“°κΈ° λΉ„μ¨ λ°μμΌλ΅ λ” μ •ν™•ν• λ¨λΈλ§**

### 4.3 λ³‘λ© μ§€μ  λ¶„μ„

#### v1 λ¨λΈ
- **λ³‘λ©**: write bound (957.5 MiB/s)
- **λ¬Έμ **: μ‹¤μ  L2 λ³‘λ©μ„ λ†“μΉ¨

#### v2.1 λ¨λΈ (μμ •λ¨)
- **λ³‘λ©**: level_constraint (40.6 MiB/s)
- **μ¥μ **: L2κ°€ μ£Όμ” λ³‘λ©μ„μ„ μ¬λ°”λ¥΄κ² μ‹λ³„
- **ν•κ³„**: μ—¬μ „ν κ³Όλ„ν•κ² λ³΄μμ μΈ μμΈ΅ (88.1% κ³Όμ† μμΈ΅)
- **κ°μ„ **: μ‹¤μ  μ½κΈ°/μ“°κΈ° λΉ„μ¨ λ°μμΌλ΅ λ” μ •ν™•ν• λ¨λΈλ§

#### μ‹¤μ  μΈ΅μ •κ°’
- **λ³‘λ©**: L2 (Phase-Cμ—μ„ ν™•μΈ)
- **μ„±λ¥**: 187.1 MiB/s

---

## 5. μƒμ„Έ λ¶„μ„ λ° κ°μ„  λ°©ν–¥

### 5.1 νλΌλ―Έν„°λ³„ μν–¥ λ¶„μ„

#### Stall ν¨κ³Ό (p_stall)
- **μ›λ³Έ**: p_stall = 0.453 β†’ S_max = 33.7 MiB/s
- **μ΅°μ •**: p_stall = 0.0 β†’ S_max = 49.9 MiB/s
- **μν–¥**: 48% μ„±λ¥ ν–¥μƒ
- **λ¶„μ„**: Stall λ¨λΈλ§μ΄ κ³Όλ„ν•  μ μμ

#### μ½κΈ°/μ“°κΈ° λΉ„μ¨ (Ο_r, Ο_w)
- **μ›λ³Έ**: Ο_r = 0.913, Ο_w = 0.087
- **μ΅°μ •**: Ο_r = 0.5, Ο_w = 0.5
- **μν–¥**: B_eff 2251.3 β†’ 1824.6 MiB/s
- **λ¶„μ„**: κ· λ“± λ¶„λ°°κ°€ λ” ν„μ‹¤μ μΌ μ μμ

#### λ λ²¨λ³„ μ μ•½μ‚¬ν•­
- **L2κ°€ μ£Όμ” λ³‘λ©**: 49.9 MiB/s (μ „μ²΄μ 45.2% κ³µμ )
- **λ‹¤λ¥Έ λ λ²¨**: μƒλ€μ μΌλ΅ μ—¬μ  μμ
- **λ¶„μ„**: Level constraint λ¨λΈμ΄ λ„λ¬΄ λ³΄μμ 

### 5.2 v2.1 λ¨λΈμ ν•κ³„

#### 1. κ³Όμ† μμΈ΅ λ¬Έμ  (μμ •λ¨)
- **μ‹¤μ  λ€λΉ„ 88.1% λ‚®μ€ μμΈ΅** (μμ •λ νλΌλ―Έν„° κΈ°μ¤€)
- **Level constraintκ°€ λ„λ¬΄ λ³΄μμ **
- **μ‹¤μ  Compaction λ™μ‘κ³Ό μ°¨μ΄**
- **μ½κΈ° λΉ„μ¨μ΄ κ·Ήλ„λ΅ λ‚®μ** (0.0522%λ” λΉ„μ •μƒμ )

#### 2. νλΌλ―Έν„° μ΅°μ •μ μ–΄λ ¤μ›€
- **Ο_r, Ο_w λΉ„μ¨ κ²°μ •μ μ£Όκ΄€μ„±**
- **Stall λ¨λΈλ§μ λ³µμ΅μ„±**
- **λ λ²¨λ³„ λ™μ‹μ„± μ μ•½μ μ •ν™•ν• λ¨λΈλ§ ν•„μ”**

#### 3. λ¨λΈ λ³µμ΅μ„±
- **νλΌλ―Έν„° μ μ¦κ°€**
- **νλ‹ μ–΄λ ¤μ›€**
- **μ‹¤μ  μ΄μ ν™κ²½ μ μ©μ λ³µμ΅μ„±**

### 5.3 κ°μ„  λ°©ν–¥

#### 1. Level Constraint λ¨λΈ κ°μ„ 
- **ν„μ¬**: λ„λ¬΄ λ³΄μμ μΈ μ μ•½
- **κ°μ„ μ•**: μ‹¤μ  Compaction λ™μ‘ ν¨ν„΄ λ°μ
- **λ°©λ²•**: λ” λ§μ€ μ‹¤ν— λ°μ΄ν„°λ΅ λ³΄μ •

#### 2. νλΌλ―Έν„° νλ‹ κ°€μ΄λ“
- **Ο_r, Ο_w λΉ„μ¨**: ν™κ²½λ³„ μµμ ν™”
- **Stall λ¨λΈλ§**: λ” μ •κµν• λ¨λΈ κ°λ°
- **λ λ²¨λ³„ λ™μ‹μ„±**: μ‹¤μ  λ™μ‘ ν¨ν„΄ λ¶„μ„

#### 3. μ‹¤μ  λ°μ΄ν„° κΈ°λ° λ³΄μ •
- **λ” λ§μ€ μ‹¤ν— λ°μ΄ν„° μμ§‘**
- **ν™κ²½λ³„ νλΌλ―Έν„° μ΅°μ •**
- **μ§€μ†μ μΈ λ¨λΈ κ°μ„ **

---

## 6. κ²°λ΅  λ° κ¶μ¥μ‚¬ν•­

### 6.1 v2.1 λ¨λΈμ μ„±κ³Ό

#### β… μ£Όμ” μ„±κ³Ό
1. **μ •ν™•λ„ λ€ν­ κ°μ„ **: v1 λ€λΉ„ 58.2% μ •ν™•λ„ ν–¥μƒ
2. **λ³‘λ© μ§€μ  μ •ν™• μ‹λ³„**: L2κ°€ μ£Όμ” λ³‘λ©μ„μ„ μ¬λ°”λ¥΄κ² νμ•…
3. **μ„Έλ°€ν• λ¶„μ„ μ κ³µ**: λ λ²¨λ³„ μƒμ„Έ λ¶„μ„ κ°€λ¥
4. **ν„μ‹¤μ  λ¨λΈλ§**: Harmonic meanκ³Ό Stall ν¨κ³Ό λ°μ

#### π“ μ •λ‰μ  μ„±κ³Ό (μμ •λ¨)
- **μ¤λ¥μ¨ κ°μ„ **: 211.1% β†’ 88.1% (122.9%p ν–¥μƒ)
- **λ³‘λ© μ‹λ³„ μ •ν™•λ„**: 100% (L2 λ³‘λ© μ¬λ°”λ¥΄κ² μ‹λ³„)
- **λ¶„μ„ μ„Έλ°€λ„**: λ λ²¨λ³„ μƒμ„Έ λ¶„μ„ μ κ³µ
- **νλΌλ―Έν„° μ •ν™•μ„±**: μ‹¤μ  μ½κΈ°/μ“°κΈ° λΉ„μ¨ λ°μ

### 6.2 v2.1 λ¨λΈμ ν•κ³„

#### β οΈ μ£Όμ” ν•κ³„
1. **κ³Όμ† μμΈ΅**: μ‹¤μ λ³΄λ‹¤ 88.1% λ‚®μ€ μμΈ΅ (μμ •λ νλΌλ―Έν„° κΈ°μ¤€)
2. **Level constraint λ³΄μμ **: λ„λ¬΄ μ—„κ²©ν• μ μ•½
3. **νλΌλ―Έν„° μ΅°μ • μ–΄λ ¤μ›€**: Ο_r, Ο_w λΉ„μ¨ κ²°μ •μ μ£Όκ΄€μ„±
4. **λ¨λΈ λ³µμ΅μ„±**: νλΌλ―Έν„° μ μ¦κ°€λ΅ μΈν• νλ‹ μ–΄λ ¤μ›€

### 6.3 κ¶μ¥μ‚¬ν•­

#### π― λ‹¨κΈ° κ°μ„ μ‚¬ν•­
1. **Level constraint λ¨λΈ μ™„ν™”**
   - ν„μ¬ λ¨λΈμ΄ λ„λ¬΄ λ³΄μμ 
   - μ‹¤μ  Compaction λ™μ‘ ν¨ν„΄ λ°μ ν•„μ”

2. **νλΌλ―Έν„° νλ‹ κ°€μ΄λ“ κ°λ°**
   - ν™κ²½λ³„ μµμ  νλΌλ―Έν„° μ΅°μ • λ°©λ²•
   - μλ™ νλ‹ λ„κµ¬ κ°λ°

#### π€ μ¥κΈ° κ°μ„ μ‚¬ν•­
1. **μ‹¤μ  λ°μ΄ν„° κΈ°λ° λ³΄μ •**
   - λ” λ§μ€ μ‹¤ν— λ°μ΄ν„° μμ§‘
   - ν™κ²½λ³„ νλΌλ―Έν„° λ°μ΄ν„°λ² μ΄μ¤ κµ¬μ¶•

2. **λ¨λΈ μ§€μ†μ  κ°μ„ **
   - v2.2, v2.3 λ“± μ§€μ†μ  λ²„μ „ μ—…
   - μ‹¤μ  μ΄μ ν™κ²½ ν”Όλ“λ°± λ°μ

### 6.4 μµμΆ… ν‰κ°€

#### v2.1 λ¨λΈμ κ°€μΉ
- **v1 λ€λΉ„ μƒλ‹Ήν• κ°μ„ **: 61.2% μ •ν™•λ„ ν–¥μƒ
- **λ³‘λ© μ§€μ  μ •ν™• μ‹λ³„**: L2 λ³‘λ© μ¬λ°”λ¥΄κ² νμ•…
- **μ„Έλ°€ν• λ¶„μ„ κ°€λ¥**: λ λ²¨λ³„ μƒμ„Έ λ¶„μ„ μ κ³µ
- **ν„μ‹¤μ  λ¨λΈλ§**: Harmonic meanκ³Ό Stall ν¨κ³Ό λ°μ

#### μ‚¬μ© κ¶μ¥μ‚¬ν•­
- **v2.1 λ¨λΈμ„ κΈ°λ³ΈμΌλ΅ μ‚¬μ©**
- **Level constraint μ™„ν™” ν•„μ”**
- **μ‹¤μ  μ΄μ λ°μ΄ν„°λ΅ μ§€μ†μ  λ³΄μ •**
- **ν™κ²½λ³„ νλΌλ―Έν„° νλ‹ ν•„μ**

---

## π“ κ΄€λ ¨ νμΌ

- **v2.1 κ³„μ‚°κΈ°**: `scripts/smax_calc_v2.py`
- **κ²€μ¦ κ²°κ³Ό**: `experiments/2025-09-05/v2_model_validation_results.md`
- **μ‹¤ν— λ°μ΄ν„°**: `experiments/2025-09-05/experiment_data.json`
- **μΆ…ν•© λ³΄κ³ μ„**: `experiments/2025-09-05/experiment_final_report.md`

---

**μ™„λ£μΌ**: 2025-09-05  
**μƒνƒ**: β… μ™„λ£  
**λ‹¤μ λ‹¨κ³„**: Level constraint λ¨λΈ κ°μ„  λ° μ¶”κ°€ μ‹¤ν—
