# options-leveled.ini (RocksDB leveled compaction baseline)
# Adjust paths and numbers to your hardware before use.

# Compaction
compaction_style=kCompactionStyleLevel
compaction_pri=kMinOverlappingRatio
num_levels=7
level_compaction_dynamic_level_bytes=false
max_bytes_for_level_multiplier=10
target_file_size_base=268435456                 # 256 MiB
target_file_size_multiplier=1
max_bytes_for_level_base=2684354560             # 2.5 GiB (T≈10 from L1)

# Compression
compression=kSnappy
bottommost_compression=kZSTD

# Memtable / flush
write_buffer_size=268435456                     # 256 MiB
max_write_buffer_number=3
min_write_buffer_number_to_merge=1
enable_pipelined_write=true
allow_concurrent_memtable_write=true

# Background jobs
max_background_jobs=12
max_subcompactions=4

# Thread configuration for different workloads
# threads=8:  보수적 (CPU 코어의 1/6)
# threads=16: 균형 (CPU 코어의 1/3) ← 기본값
# threads=32: 공격적 (CPU 코어의 2/3)

# L0 triggers (tune to device)
level0_file_num_compaction_trigger=4
level0_slowdown_writes_trigger=20
level0_stop_writes_trigger=36

# File descriptor management (to avoid "Too many open files")
# 512: 기본값 (메모리 효율적)
# 2048: 실험용 (더 많은 파일 열기)
max_open_files=2048
keep_log_file_num=3

# I/O & sync
bytes_per_sync=1048576                          # 1 MiB
wal_bytes_per_sync=1048576
use_direct_reads=true
use_direct_io_for_flush_and_compaction=true

# Readahead (set 0 for NVMe; >0 for HDDs)
compaction_readahead_size=0

# Statistics & logging
statistics=true
report_bg_io_stats=true
stats_dump_period_sec=60

# Rate limiter (0 disables capping; set to e.g., 800MB/s = 800*1024*1024)
rate_limiter_bytes_per_sec=0

# Paths
db_path=/rocksdb/data
# wal_dir=/rocksdb/wal   # uncomment to separate WAL device
